!function(t){function e(t){switch(typeof t){case"object":return t;case"string":return document.querySelector?document.querySelector(t):document.getElementById(t.replace(/#/i,""))}}function r(t){var e={hash:"",queryString:"",params:{},query:{},path:t},r=e.path.indexOf("#");r>=0&&(e.hash=e.path.slice(r+1),e.path=e.path.slice(0,r));var n=e.query,o=e.path.indexOf("?");if(o>=0){e.queryString=e.path.slice(o+1),e.path=e.path.slice(0,o);for(var i=e.queryString.split("&"),s=0;s<i.length;s++){var a=i[s],u=a.indexOf("="),c="";u>0&&(c=a.slice(u+1),a=a.slice(0,u));var h=decodeURIComponent(a);c=decodeURIComponent(c),n.hasOwnProperty(h)?n[h]=[].concat(n[h],c):n[h]=c}}return e}function n(t){if(!t)return"";if("string"==typeof t)return t;var e,r=t.query,n=t.params,o=t.path||"",i=[];if(o)for(var s=o.split("/"),a=0,u=s.length;a<u;a++){var c=s[a];if(/^:[a-z0-9_-]+$/.test(c)){e=!0;var h=c.slice(1);i.push(n&&n[h]||r&&r[h])}else i.push(c)}var p=t.queryString||"";if(0===p.indexOf("?")&&(p=p.slice(1)),!p&&r&&(!e||n)){var f=!0;for(var l in r)r.hasOwnProperty(l)&&(p+=(f?"":"&")+l+"="+encodeURIComponent(r[l]),f=!1)}return i.join("/")+(p&&"?")+p}function o(t,e){var n=r(t),o=r(e),i=n.path;if(0===i.indexOf("/"))return t;var s;if(i){var a=i.split("/"),u=o.path.split("/");u.pop();for(var c=0;c<a.length;c++){var h=a[c];switch(h){case"..":u.pop();break;case".":break;default:u.push(h)}}""!==u[0]&&u.unshift(""),s=u.join("/")}else s=o.path;return s+(n.queryString?"?"+n.queryString:"")}function i(){}function s(){var t=location.href.indexOf("#");return t<0?"/":location.href.slice(t+1)||"/"}function a(t){var e=location.href,r=e.indexOf("#");return e.slice(0,r+1)+t}function u(){this.current=s(),this.referrer="";var t=this;this.hashChangeHandler=function(){t.redirect(s())}}function c(){return location.pathname+location.search}function h(){if(!h.isSupport)throw new Error("[SAN-ROUTER ERROR] Your navigator doesn't supports HTML5!");this.current=c(),this.referrer="";var t=this;this.popstateHandler=function(){t.referrer=t.current,t.current=c(),t.fire("redirect",{url:t.current,referrer:t.referrer})}}function p(){return(++R).toString()}function f(t){return t.prototype&&(5===t.prototype.nodeType||"san-cmpt"===t.prototype._type)}function l(t){t=t||{};var e=t.mode||"hash";this.routes=[],this.routeAlives=[],this.listeners=[],this.__withRouteListeners=[],this.__redirectListener=v(this),this.setMode(e)}function d(t,e){var r=e.rule,n=[""];if("string"==typeof r){var o=r.replace(/\/:([a-z0-9_-]+)(?=\/|$)/gi,function(t,e){return n.push(e),"/([^/\\s]+)"});r=new RegExp("^"+o+"$","i")}if(!(r instanceof RegExp))throw new Error("[SAN-ROUTER ERROR] Rule must be string or RegExp!");var i=p();t.routes.push({id:i,rule:r,handler:e.handler,keys:n,target:e.target||"#main",Component:e.Component,config:e})}function v(t){return function(e){function n(){if(c>0){if(u<t.listeners.length){t.listeners[u++].call(t,h)}else o();c>0&&n()}}function o(){if(c=-1,s)y(t,s);else for(var e=t.routeAlives.length;e--;)t.routeAlives[e].component.dispose(),t.routeAlives.splice(e,1)}var i=r(e.url),s=t.match(i,e.referrer),a=s?s.data:i,u=0,c=1,h={url:e.url,hash:a.hash,queryString:a.queryString,query:a.query,params:a.params,path:a.path,referrer:e.referrer,config:s&&s.route.config,data:s&&s.data,resume:function(){0===c&&(c=1,n())},suspend:function(){c=0},stop:function(){c=-1}};n()}}function y(t,e){for(var r=e.route,n=!1,o=t.routeAlives.length,i=t.__withRouteListeners.slice(0);o--;){var s=t.routeAlives[o];s.id===r.id?(s.component.data.set("route",e.data),"function"==typeof s.component.route&&s.component.route(),n=!0):(s.component.dispose(),t.routeAlives.splice(o,1))}n||(r.Component?f(r.Component)?g(t,e):r.Component().then(function(n){f(n)?r.Component=n:n.__esModule&&f(n.default)&&(r.Component=n.default),g(t,e)}):r.handler.call(t,e.data));for(var a=0,u=i.length;a<u;a++)i[a](e)}function g(t,r){var n=r.route,o=new n.Component;o.$router=t,o.data.set("route",r.data),"function"==typeof o.route&&o.route();var i=n.target,s=e(i);if(!s)throw new Error('[SAN-ROUTER ERROR] Attach failed, target element "'+n.target+'" is not found.');o.attach(s),t.routeAlives.push({component:o,id:n.id}),"function"==typeof n.handler&&setTimeout(function(){n.handler.call(t,r.data)})}function m(t){var e=new Function;e.prototype=t.prototype;var r=function(e){return t.call(this,e)||this};return r.prototype=new e,r.prototype.constructor=r,e.prototype.hasOwnProperty("aPack")&&(r.prototype.aPack=e.prototype.aPack),r}function w(t){var e;return e=0===t.toString().indexOf("class")?S(t):m(t),e.template=t.template,e.components=t.components,e.trimWhitespace=t.trimWhitespace,e.delimiters=t.delimiters,e.autoFillStyleAndId=t.autoFillStyleAndId,e.filters=t.filters,e.computed=t.computed,e.aPack=t.aPack,e.messages=t.messages,e}function L(t,e){e=e||E;var r,n,o;"function"==typeof t?(n=w(t),r=t.prototype,o=n.prototype):(r=t||{},n=Object.assign({},t),o=n);var i=r.inited;o.inited=function(){this.$router=e,this.data.set("route",e.match(e.locator.current,e.locator.referrer).data),"function"==typeof this.route&&this.route();var t=this;this.__routerListener=function(e){t.data.set("route",e.data),"function"==typeof t.route&&t.route()},e.__withRouteListeners.push(this.__routerListener),"function"==typeof i&&i.call(this)};var s=r.disposed;return o.disposed=function(){if(this.$router){for(var t=this.$router.__withRouteListeners,e=t.length;e--;)if(t[e]===this.__routerListener){t.splice(e,1);break}this.__routerListener=null,this.$router=null}"function"==typeof s&&s.call(this)},n}function _(t){return{template:'<a href="{{hrefPrefix}}{{href}}" onclick="return false;" on-click="clicker($event)" target="{{target}}" class="{{isActive ? activeClass : \'\'}}"><slot/></a>',clicker:function(e){var r=this.data.get("href");"string"==typeof r&&t.locator.redirect(r.replace(/^#/,"")),e.preventDefault?e.preventDefault():e.returnValue=!1},inited:function(){var e=this;this.routeListener=function(t){e.data.set("isActive",t.url===e.data.get("href"))},this.routeListener({url:t.locator.current}),t.listen(this.routeListener)},disposed:function(){t.unlisten(this.routeListener),this.routeListener=null},initData:function(){return{isActive:!1,hrefPrefix:"hash"===t.mode?"#":""}},computed:{href:function(){return o(this.data.get("to")||"",t.locator.current)}}}}i.prototype.on=function(t,e){"function"==typeof e&&(this._eventListeners||(this._eventListeners={}),this._eventListeners[t]||(this._eventListeners[t]=[]),this._eventListeners[t].push(e))},i.prototype.un=function(t,e){if(this._eventListeners&&this._eventListeners[t])if(e)for(var r=this._eventListeners[t],n=r.length;n--;)r[n]===e&&r.splice(n,1);else this._eventListeners[t]=[]},i.prototype.fire=function(t,e){if(!t)throw new Error("No event type specified");var r=this._eventListeners&&this._eventListeners[t];if(r)for(var n=0;n<r.length;n++)r[n](e)},u.prototype=new i,u.prototype.constructor=u,u.prototype.start=function(){window.addEventListener&&window.addEventListener("hashchange",this.hashChangeHandler,!1),window.attachEvent&&window.attachEvent("onhashchange",this.hashChangeHandler)},u.prototype.stop=function(){window.removeEventListener&&window.removeEventListener("hashchange",this.hashChangeHandler,!1),window.detachEvent&&window.detachEvent("onhashchange",this.hashChangeHandler)},u.prototype.redirect=function(t,e){e=e||{},t=o(t,this.current);var r=this.current,n=t!==r;n?(this.referrer=r,this.current=t,e.replace?location.replace(a(t)):location.hash=t):r=this.referrer,!n&&!e.force||e.silent||this.fire("redirect",{url:t,referrer:r})},u.prototype.reload=function(){this.redirect(this.current,{force:!0})},h.prototype=new i,h.prototype.constructor=h,h.prototype.start=function(){window.addEventListener("popstate",this.popstateHandler)},h.prototype.stop=function(){window.removeEventListener("popstate",this.popstateHandler)},h.prototype.redirect=function(t,e){e=e||{},t=o(t,this.current);var r=this.current,n=t!==r;n&&(this.referrer=r,this.current=t,history[e.replace?"replaceState":"pushState"]({},"",t)),!n&&!e.force||e.silent||this.fire("redirect",{url:t,referrer:r})},h.prototype.reload=function(){this.fire("redirect",{url:this.current,referrer:this.referrer})},h.isSupport="pushState"in window.history;var R=365611;l.prototype.match=function(t,e){"string"==typeof t&&(t=r(t));for(var n=0;n<this.routes.length;n++){var o=this.routes[n],i=o.rule.exec(t.path);if(i){for(var s=o.keys||[],a=1;a<i.length;a++){var u=s[a]||a,c=i[a];t.query[u]=c,t.params[u]=c}return{data:{hash:t.hash,queryString:t.queryString,params:t.params,query:t.query,path:t.path,referrer:e},url:t,route:o}}}return null},l.prototype.listen=function(t){this.listeners.push(t)},l.prototype.unlisten=function(t){for(var e=this.listeners.length;e--;)this.listeners[e]===t&&this.listeners.splice(e,1)},l.prototype.start=function(){return this.isStarted||(this.isStarted=!0,this.locator.on("redirect",this.__redirectListener),this.locator.start(),this.locator.reload()),this},l.prototype.stop=function(){return this.locator.un("redirect",this.__redirectListener),this.locator.stop(),this.isStarted=!1,this},l.prototype.setMode=function(t){if(t=t.toLowerCase(),this.mode!==t){this.mode=t;var e=!1;switch(this.isStarted&&(this.stop(),e=!0),t){case"hash":this.locator=new u;break;case"html5":this.locator=new h}return e&&this.start(),this}},l.prototype.add=function(t){if(t instanceof Array)for(var e=0,r=t.length;e<r;e++)d(this,t[e]);else"object"==typeof t&&d(this,t);return this},l.prototype.push=function(t,e){this.locator.redirect(n(t),e)},l.prototype.replace=function(t,e){e=Object.assign({replace:!0},e),this.locator.redirect(n(t),e)};var S,E=new l;try{S=new Function("RawClass","return class extends RawClass {}")}catch(t){}var q={Link:_(E),createLink:_,withRoute:L,router:E,Router:l,HashLocator:u,HTML5Locator:h,resolveURL:o,parseURL:r,stringifyURL:n,version:"2.0.2"};"object"==typeof exports&&"object"==typeof module?exports=module.exports=q:"function"==typeof define&&define.amd?define("san-router",[],q):t.sanRouter=q}(this);